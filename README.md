# Setting up the Pulsar environment in Docker
Ga to the docker folder and start the pulsar stack using the following command:<br>
`docker-compose -p "pulsar-stack" up`

Once the two containers (pulsar and pulsar manager (dashboard)) are started, we can configure the admin user for logging in on the dashboard using the following commands on the command line<br>
`CSRF_TOKEN=$(curl http://localhost:7750/pulsar-manager/csrf-token)`

`curl -H "X-XSRF-TOKEN: $CSRF_TOKEN" -H "Cookie: XSRF-TOKEN=$CSRF_TOKEN;" -H 'Content-Type: application/json' -X PUT http://localhost:7750/pulsar-manager/users/superuser -d '{"name": "admin", "password": "apachepulsar", "description": "test", "email": "username@test.org"}'`

After running these two command, you should be able to login on the following URL:<br>
http://localhost:9527/

Create an environment (for instance called dev-environment) using the following URLs:<br>
http://pulsar:8080 (Service URL) <br>
http://pulsar:6650 (Bookie URL) <br>

After this you can look the default setup that is available. In the following we will the tenant public and the namespace default.

# Starting the application
To run the Sping Boot Application the following VM arguments need to be added when starting.<br>
`--add-opens java.base/sun.net=ALL-UNNAMED`

## PulsarTimePublisher
When the application is started, the PulsarTimePublisher will publish a message to the times topic every 30 seconds. The message contains a String with the current date and time. The topic will be created automatically and will show up in the dashboard. In the application logs you see the names of the topic and the subscription generated by the corresponding consumer.<br>
Notice that the admin.http file contains a request you can use to reset a subscription a number of seconds. You can use this to replay the messages you already processed.
There are also sample requests to find a specific message on a topic based on the timestamp it got published.

## PulsarUserPublisher
When the application is started, the PulsarUserPublisher will publish a message to the users topic every 30 seconds. The difference here is that we are AVRO schemas to be able to publish pojo's to the topic. <br>
Notice that the admin.http file contains a request you can use to check the schema of a topic. If you use this you will see that the users topic uses a generated AVRO schema.

## PulsarGamePublisher
TO DO: Use a defined schema to generate java classes and prepare a topic before starting the application. Also disable auto creation of topic and auto subscription.

## Pulsar Admin commands

./pulsar-admin persistent reset-cursor --subscription listener-1 --time 300 persistent://public/default/test

./pulsar-admin persistent reset-cursor --subscription my-subscription2 --time 60 persistent://public/default/test

## Note
pulsar-admin brokers update-dynamic-config --config xxx --value xxx


